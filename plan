DÆ°á»›i Ä‘Ã¢y lÃ  **tÃ i liá»‡u Ä‘áº§y Ä‘á»§ â€“ chuáº©n hÃ³a dáº¡ng module** cho **Module 2: Lottie Intake & Validator**, theo Ä‘Ãºng chuáº©n cá»§a má»™t pipeline video engine chuyÃªn nghiá»‡p.

---

# #ï¸âƒ£ **MODULE 2 â€” LOTTIE INTAKE & VALIDATOR**

## ğŸ¯ **1. Tá»•ng quÃ¡t: Module nÃ y lÃ m gÃ¬?**

Module 2 chá»‹u trÃ¡ch nhiá»‡m:

### **A. Nháº­p (intake) toÃ n bá»™ file Lottie `.json`**

Tá»« thÆ° má»¥c:

```
/public/assets/library/animations/lottie/*
```

### **B. Validate (kiá»ƒm tra) cÃ¡c Lottie trÆ°á»›c khi cho vÃ o há»‡ thá»‘ng**

Kiá»ƒm tra:

* File JSON cÃ³ há»£p lá»‡ khÃ´ng?
* CÃ³ frame rate khÃ´ng?
* CÃ³ expression JS khÃ´ng? (Remotion khÃ´ng há»— trá»£ AE expressions)
* Resize cÃ³ phÃ¹ há»£p khÃ´ng?
* Structure chá»©a layers Ä‘Ãºng chuáº©n khÃ´ng?
* Asset external cÃ³ thiáº¿u khÃ´ng?
* Lottie cÃ³ vÆ°á»£t kÃ­ch thÆ°á»›c file max khÃ´ng?

### **C. Generate manifest & registry**

Tá»± Ä‘á»™ng sinh ra 2 file:

```
src/effects/registry/lottieRegistry.json
src/effects/registry/manifest.json   // Ã¡p dá»¥ng chung cho engines/lottie
```

### **D. Chuáº©n hÃ³a metadata cho resolver**

Táº¡o metadata:

* `id`
* `category`
* `durationFrames`
* `fps`
* `tags`
* `componentPath`
* `assetPath`

â†’ Äá»ƒ resolver + template engine cÃ³ thá»ƒ dÃ¹ng Lottie nhÆ° 1 effect thÃ´ng thÆ°á»ng.

---

# ğŸ§  **2. SOP â€” Standard Operating Procedure (cÃ¡c bÆ°á»›c thá»±c hiá»‡n chi tiáº¿t)**

DÆ°á»›i Ä‘Ã¢y lÃ  **quy trÃ¬nh chuáº©n**, dÃ¹ng cho dev hoáº·c automation cháº¡y Ä‘á»‹nh ká»³.

---

## âœ”ï¸ **STEP 1 â€” Place Lottie assets in public**

Táº¥t cáº£ file:

```
*.json
```

Ä‘Æ°á»£c Ä‘áº·t vÃ o:

```
/public/assets/library/animations/lottie/
```

---

## âœ”ï¸ **STEP 2 â€” Cháº¡y script intake**

Script:

```
scripts/intakeLottie.ts
```

Nhiá»‡m vá»¥:

1. QuÃ©t thÆ° má»¥c public/lottie
2. Load tá»«ng JSON
3. Extract cÃ¡c thÃ´ng tin chÃ­nh:

   * v (version)
   * fr (fps)
   * ip/op (start/end frame â†’ duration)
   * w/h (dimension)
   * assets
   * layers count
4. Chuáº©n hÃ³a tÃªn asset â†’ slug

Káº¿t quáº£ lÆ°u vÃ o object:

```ts
{
  id: "sparkle",
  name: "Sparkle",
  path: "/assets/library/animations/lottie/sparkle.json",
  width: 512,
  height: 512,
  fps: 30,
  durationFrames: 59,
  tags: ["decoration", "sparkle"]
}
```

---

## âœ”ï¸ **STEP 3 â€” Validate**

Cháº¡y script:

```
scripts/validateLottie.ts
```

Validation gá»“m:

### ğŸ”¹ 1. JSON parse Ä‘Æ°á»£c?

Náº¿u lá»—i â†’ reject ngay.

### ğŸ”¹ 2. CÃ¡c trÆ°á»ng báº¯t buá»™c cÃ³ tá»“n táº¡i?

```json
v, fr, ip, op, w, h, layers
```

### ğŸ”¹ 3. KhÃ´ng chá»©a unsupported features?

* Expressions
* Time remap
* Effects group
* Masks quÃ¡ phá»©c táº¡p

### ğŸ”¹ 4. Asset external khÃ´ng bá»‹ missing

### ğŸ”¹ 5. KÃ­ch thÆ°á»›c file khÃ´ng vÆ°á»£t 500kb

â†’ TÃ¹y báº¡n Ä‘áº·t threshold

### ğŸ”¹ 6. FPS há»£p lá»‡ (Remotion chá»‰ cháº¡y tá»« 24â€“60)

Náº¿u lá»—i â†’ in ra báº£ng cáº£nh bÃ¡o.

---

## âœ”ï¸ **STEP 4 â€” Generate Lottie registry**

Táº¡o file:

```
src/effects/registry/lottieRegistry.json
```

Gá»“m:

* ToÃ n bá»™ metadata
* Slug chuáº©n hÃ³a
* Category auto-detect (náº¿u cÃ³)

VÃ­ dá»¥:

```json
{
  "sparkle": {
    "id": "sparkle",
    "category": "decoration",
    "tags": ["sparkle"],
    "fps": 30,
    "durationFrames": 59,
    "path": "/assets/library/animations/lottie/sparkle.json"
  }
}
```

---

## âœ”ï¸ **STEP 5 â€” Generate manifest**

File:

```
src/effects/registry/manifest.json
```

Gá»“m mapping Ä‘á»ƒ preview app + engines dÃ¹ng:

```json
{
  "lottie": {
    "sparkle": {
      "component": "@/effects/engines/lottie/LottieEffect",
      "assetPath": "/assets/library/animations/lottie/sparkle.json"
    }
  }
}
```

---

## âœ”ï¸ **STEP 6 â€” Update engines/lottie classes**

`useLottieByKey.ts` cáº§n:

* Äá»c lottieRegistry
* Tráº£ vá» component `<LottieEffect />`

---

## âœ”ï¸ **STEP 7 â€” Preview & QA**

`effects/preview/LottiePreviewPanel` yÃªu cáº§u:

* Load táº¥t cáº£ lottie tá»« registry
* Render thá»­ tá»«ng cÃ¡i
* Hiá»ƒn thá»‹:

  * duration
  * fps
  * bounding box
  * warnings náº¿u cÃ³

---

# ğŸ“¦ **3. Output chÃ­nh xÃ¡c cá»§a Module 2**

Sau khi module hoÃ n táº¥t, báº¡n sáº½ cÃ³ 3 output:

---

## **OUTPUT 1 â€” Lottie Registry (báº¯t buá»™c)**

File:

```
src/effects/registry/lottieRegistry.json
```

Chá»©a metadata Ä‘Ã£ chuáº©n hoÃ¡.

---

## **OUTPUT 2 â€” Lottie manifest (báº¯t buá»™c)**

File:

```
src/effects/registry/manifest.json
```

Mapping tá»« key â†’ component.

---

## **OUTPUT 3 â€” Lottie Preview Panel (optional nhÆ°ng khuyáº¿n nghá»‹)**

Äá»ƒ test vÃ  xem asset.

---

# â˜‘ï¸ **4. Checklist hoÃ n thÃ nh Module 2 (cÃ³ thá»ƒ tick)**

### ğŸ“ File & folder

* [ ] Public chá»©a Ä‘áº§y Ä‘á»§ lottie JSON
* [ ] KhÃ´ng cÃ³ file ngoÃ i Ä‘á»‹nh dáº¡ng `.json`

### ğŸ” Intake

* [ ] Script cháº¡y Ä‘Æ°á»£c, khÃ´ng lá»—i
* [ ] Auto generate slug + id
* [ ] TÃ­nh Ä‘Ãºng fps, durationFrames

### ğŸ§ª Validator

* [ ] Pass JSON format check
* [ ] Pass required fields check
* [ ] KhÃ´ng cÃ³ expression
* [ ] KhÃ´ng cÃ³ external asset missing
* [ ] File size < 500kb
* [ ] FPS há»£p lá»‡

### ğŸ“‘ Registry

* [ ] lottieRegistry.json Ä‘Æ°á»£c cáº­p nháº­t
* [ ] manifest.json Ä‘Æ°á»£c cáº­p nháº­t
* [ ] Key â†’ component mapping Ä‘Ãºng

### ğŸ”§ Engines

* [ ] useLottieByKey tráº£ Ä‘Ãºng component
* [ ] LottieEffect nháº­n props Ä‘Ãºng format

### ğŸ‘ Preview

* [ ] LottiePreviewPanel render Ä‘Æ°á»£c táº¥t cáº£
* [ ] Thumbnail hiá»ƒn thá»‹ Ä‘Ãºng
* [ ] Hiá»ƒn thá»‹ fps + duration chÃ­nh xÃ¡c

---

# ğŸ§ª **5. CÃ¡ch test module 2 hoáº¡t Ä‘á»™ng thÃ nh cÃ´ng**

## âœ” TEST 1 â€” Test CLI

Cháº¡y:

```
npm run intake:lottie
npm run validate:lottie
npm run manifest:lottie
```

â†’ KhÃ´ng lá»—i â†’ PASS

---

## âœ” TEST 2 â€” Test preview

VÃ´ URL:

```
/preview/lottie
```

â†’ Render Ä‘Æ°á»£c toÃ n bá»™ asset
â†’ KhÃ´ng bÃ¡o lá»—i á»Ÿ console

---

## âœ” TEST 3 â€” TÃ­ch há»£p

Táº¡o file test:

```tsx
<LottieEffect id="sparkle" />
```

â†’ Render animation bÃ¬nh thÆ°á»ng

---

## âœ” TEST 4 â€” Resolver

Sau khi thÃªm vÃ o effects.json:

```json
{
  "id": "sparkle",
  "category": "overlay"
}
```

DÃ¹ng:

```tsx
useEffectByKey("overlay.sparkle")
```

â†’ Xuáº¥t ra LottieEffect Ä‘Ãºng slug.

---

# ğŸ‰ Káº¾T LUáº¬N

Module 2 lÃ  module **Ä‘áº£m báº£o cháº¥t lÆ°á»£ng cá»§a toÃ n bá»™ Lottie**, vÃ  output cá»§a nÃ³ lÃ :

* **Registry chuáº©n hoÃ¡**
* **Manifest**
* **Preview UI**
* **HÃ m load Lottie tá»± Ä‘á»™ng**

ğŸ’¬ Báº¡n muá»‘n mÃ¬nh viáº¿t luÃ´n file code máº«u cho:

* `intakeLottie.ts`
* `validateLottie.ts`
* `generateLottieManifest.ts`

khÃ´ng? (viáº¿t dáº¡ng hoÃ n chá»‰nh production luÃ´n).
